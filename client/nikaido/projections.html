<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Nikaido Growth Projection Tool</title>
	<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
	<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
	<div id="root"></div>

	<script type="text/babel">
		const { useState, useRef, useEffect } = React;

		const NikaidoGrowthTool = () => {
		  const initialData = [
			{ year: 2025, bottles: 50000 },
			{ year: 2026, bottles: 60000 },
			{ year: 2027, bottles: 75000 },
			{ year: 2028, bottles: 90000 },
			{ year: 2029, bottles: 120000 },
			{ year: 2030, bottles: 180000 },
			{ year: 2031, bottles: 300000 },
			{ year: 2032, bottles: 500000 },
			{ year: 2033, bottles: 900000 },
			{ year: 2034, bottles: 1500000 },
			{ year: 2035, bottles: 2800000 },
			{ year: 2036, bottles: 5000000 },
			{ year: 2037, bottles: 8000000 },
			{ year: 2038, bottles: 10000000 }
		  ];

		  const [data, setData] = useState(initialData);
		  const [draggingIndex, setDraggingIndex] = useState(null);
		  const svgRef = useRef(null);

		  const width = 1400;
		  const height = 600;
		  const padding = { top: 40, right: 40, bottom: 60, left: 100 };
		  const chartWidth = width - padding.left - padding.right;
		  const chartHeight = height - padding.top - padding.bottom;

		  const minBottles = 0;
		  const maxBottles = 10000000;

		  const yAxisLabels = [0, 50000, 75000, 100000, 150000, 250000, 400000, 650000, 1000000, 1500000, 2500000, 4000000, 6000000, 8000000, 10000000];

		  // Map bottle values to evenly-spaced Y positions
		  const yScale = (bottles) => {
			// Find position in the label array
			for (let i = 0; i < yAxisLabels.length - 1; i++) {
			  if (bottles >= yAxisLabels[i] && bottles <= yAxisLabels[i + 1]) {
				const ratio = (bottles - yAxisLabels[i]) / (yAxisLabels[i + 1] - yAxisLabels[i]);
				const startY = (i / (yAxisLabels.length - 1)) * chartHeight;
				const endY = ((i + 1) / (yAxisLabels.length - 1)) * chartHeight;
				return chartHeight - (startY + ratio * (endY - startY));
			  }
			}
			// Handle edge cases
			if (bottles <= 0) return chartHeight;
			if (bottles >= maxBottles) return 0;
			return chartHeight / 2;
		  };

		  const yScaleInverse = (y) => {
			// Convert Y position back to bottles
			const normalizedY = (chartHeight - y) / chartHeight;
			const position = normalizedY * (yAxisLabels.length - 1);
			const lowerIndex = Math.floor(position);
			const upperIndex = Math.ceil(position);
			
			if (lowerIndex === upperIndex || lowerIndex < 0) return yAxisLabels[Math.max(0, lowerIndex)];
			if (upperIndex >= yAxisLabels.length) return yAxisLabels[yAxisLabels.length - 1];
			
			const ratio = position - lowerIndex;
			return yAxisLabels[lowerIndex] + ratio * (yAxisLabels[upperIndex] - yAxisLabels[lowerIndex]);
		  };

		  const xScale = (index) => {
			return (index / (data.length - 1)) * chartWidth;
		  };

		  const formatBottles = (bottles) => {
			if (bottles === 0) return '0';
			if (bottles >= 1000000) return `${(bottles / 1000000).toFixed(1)}M`;
			if (bottles >= 1000) return `${(bottles / 1000).toFixed(0)}K`;
			return bottles.toString();
		  };

		  const handleMouseDown = (index) => {
			setDraggingIndex(index);
		  };

		  const handleMouseMove = (e) => {
			if (draggingIndex === null) return;

			const svg = svgRef.current;
			const rect = svg.getBoundingClientRect();
			const y = e.clientY - rect.top - padding.top;
			
			const newBottles = Math.max(0, Math.min(maxBottles, yScaleInverse(y)));
			
			const newData = [...data];
			newData[draggingIndex].bottles = Math.round(newBottles);

			setData(newData);
		  };

		  const handleMouseUp = () => {
			setDraggingIndex(null);
		  };

		  useEffect(() => {
			if (draggingIndex !== null) {
			  window.addEventListener('mousemove', handleMouseMove);
			  window.addEventListener('mouseup', handleMouseUp);
			  return () => {
				window.removeEventListener('mousemove', handleMouseMove);
				window.removeEventListener('mouseup', handleMouseUp);
			  };
			}
		  }, [draggingIndex, data]);

		  const handleReset = () => {
			setData(initialData);
		  };

		  const yearHitting1M = data.find(d => d.bottles >= 1000000)?.year || 'Not reached';
		  const yearHitting8M = data.find(d => d.bottles >= 8000000)?.year || 'Not reached';
		  
		  const totalBottles = data.reduce((sum, d) => sum + d.bottles, 0);
		  
		  const cagr = data[0].bottles > 0 
			? ((Math.pow(data[data.length - 1].bottles / data[0].bottles, 1 / (data.length - 1)) - 1) * 100).toFixed(1)
			: 'N/A';

		  // Calculate average year-over-year growth for each phase
		  const calculatePhaseGrowth = (startIndex, endIndex) => {
			let totalGrowth = 0;
			let validYears = 0;
			
			for (let i = startIndex; i < endIndex; i++) {
			  if (data[i].bottles > 0) {
				const yearGrowth = ((data[i + 1].bottles / data[i].bottles) - 1) * 100;
				totalGrowth += yearGrowth;
				validYears++;
			  }
			}
			
			return validYears > 0 ? (totalGrowth / validYears).toFixed(1) : 'N/A';
		  };

		  const phase1Growth = calculatePhaseGrowth(0, 3); // Years 1-4
		  const phase2Growth = calculatePhaseGrowth(4, 7); // Years 5-8
		  const phase3Growth = calculatePhaseGrowth(8, data.length - 1); // Years 9-14

		  return (
			<div className="w-full p-8 bg-gray-50 min-h-screen" style={{ userSelect: 'none' }}>
			  <div className="mx-auto" style={{ maxWidth: '1500px' }}>
				<div className="bg-white rounded-lg shadow-lg p-6">
				  <div className="flex justify-between items-center mb-6">
					<h2 className="text-2xl font-bold text-gray-800">Nikaido US Growth Projection</h2>
					<button
					  onClick={handleReset}
					  className="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors"
					>
					  Reset to Conservative
					</button>
				  </div>

				  <svg
					ref={svgRef}
					width={width}
					height={height}
					className="border border-gray-200 rounded"
					style={{ cursor: draggingIndex !== null ? 'grabbing' : 'default', userSelect: 'none' }}
				  >
					{yAxisLabels.map((label) => (
					  <g key={label}>
						<line
						  x1={padding.left}
						  y1={padding.top + yScale(label)}
						  x2={padding.left + chartWidth}
						  y2={padding.top + yScale(label)}
						  stroke="#e5e7eb"
						  strokeWidth="1"
						/>
						<text
						  x={padding.left - 10}
						  y={padding.top + yScale(label) + 4}
						  textAnchor="end"
						  className="text-xs fill-gray-600"
						>
						  {formatBottles(label)}
						</text>
					  </g>
					))}

					{data.map((d, i) => (
					  <text
						key={d.year}
						x={padding.left + xScale(i)}
						y={height - padding.bottom + 20}
						textAnchor="middle"
						className="text-xs fill-gray-600"
					  >
						{d.year}
					  </text>
					))}

					<polyline
					  points={data.map((d, i) => 
						`${padding.left + xScale(i)},${padding.top + yScale(d.bottles)}`
					  ).join(' ')}
					  fill="none"
					  stroke="#f97316"
					  strokeWidth="2"
					/>

					{data.map((d, i) => {
					  const yoyGrowth = i > 0 && data[i - 1].bottles > 0
						? (((d.bottles / data[i - 1].bottles) - 1) * 100).toFixed(1)
						: null;
					  
					  return (
						<g key={`point-${d.year}`}>
						  <circle
							cx={padding.left + xScale(i)}
							cy={padding.top + yScale(d.bottles)}
							r="8"
							fill="#f97316"
							stroke="white"
							strokeWidth="2"
							style={{ cursor: 'grab' }}
							onMouseDown={() => handleMouseDown(i)}
						  />
						  <text
							x={padding.left + xScale(i)}
							y={padding.top + yScale(d.bottles) - 15}
							textAnchor="middle"
							className="text-xs font-semibold fill-orange-600"
							style={{ pointerEvents: 'none' }}
						  >
							{formatBottles(d.bottles)}
						  </text>
						  {yoyGrowth !== null && (
							<text
							  x={padding.left + xScale(i)}
							  y={padding.top + yScale(d.bottles) + 25}
							  textAnchor="middle"
							  className="text-xs font-normal fill-gray-700"
							  style={{ pointerEvents: 'none' }}
							>
							  {yoyGrowth}%
							</text>
						  )}
						</g>
					  );
					})}
				  </svg>

				  <div className="mt-8 grid grid-cols-2 md:grid-cols-4 gap-6">
					<div className="bg-orange-50 p-4 rounded-lg">
					  <div className="text-sm text-gray-600 mb-1">1M Milestone</div>
					  <div className="text-2xl font-bold text-orange-600">{yearHitting1M}</div>
					</div>
					
					<div className="bg-orange-50 p-4 rounded-lg">
					  <div className="text-sm text-gray-600 mb-1">8M Milestone</div>
					  <div className="text-2xl font-bold text-orange-600">{yearHitting8M}</div>
					</div>
					
					<div className="bg-orange-50 p-4 rounded-lg">
					  <div className="text-sm text-gray-600 mb-1">Overall CAGR</div>
					  <div className="text-2xl font-bold text-orange-600">{cagr}%</div>
					</div>
					
					<div className="bg-orange-50 p-4 rounded-lg">
					  <div className="text-sm text-gray-600 mb-1">Total Bottles</div>
					  <div className="text-2xl font-bold text-orange-600">{formatBottles(totalBottles)}</div>
					</div>
				  </div>

				  <div className="mt-6 grid grid-cols-3 gap-6">
					<div className="bg-gray-50 p-4 rounded-lg">
					  <div className="text-sm text-gray-600 mb-1">Years 1-4 Growth</div>
					  <div className="text-xl font-bold text-gray-700">{phase1Growth}%</div>
					  <div className="text-xs text-gray-500">Foundation building</div>
					</div>
					
					<div className="bg-gray-50 p-4 rounded-lg">
					  <div className="text-sm text-gray-600 mb-1">Years 5-8 Growth</div>
					  <div className="text-xl font-bold text-gray-700">{phase2Growth}%</div>
					  <div className="text-xs text-gray-500">Acceleration phase</div>
					</div>
					
					<div className="bg-gray-50 p-4 rounded-lg">
					  <div className="text-sm text-gray-600 mb-1">Years 9-14 Growth</div>
					  <div className="text-xl font-bold text-gray-700">{phase3Growth}%</div>
					  <div className="text-xs text-gray-500">Mature growth</div>
					</div>
				  </div>

				  <div className="mt-6 text-sm text-gray-500 italic">
					Drag any point up or down to adjust that year's projection independently.
				  </div>
				</div>
			  </div>
			</div>
		  );
		};

		const root = ReactDOM.createRoot(document.getElementById('root'));
		root.render(<NikaidoGrowthTool />);
	</script>
</body>
</html>